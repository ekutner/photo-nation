---
weight: 100
title: "ההיסטוגרמה"
#title_align: "left"
summary: "איך להבין ולהשתמש בהיסטוגרמה"
date: 2020-09-01
draft: false
lastmod: 2020-09-15

# authors: 
#   - "eran"

profile: false

# taxonomies
# categories: 
#   - "מושגים"
# tags:
#   - "Photos"
#   - "Game"
#   - "React"
#   - "Python"
#   - "New"

featured: true

---


בכל המצלמות המקצועיות וברוב כלי העריכה, כמו לייטרום ופוטושופ, קיימת אפשרות להציג היסטוגרמה של התמונה. במצלמות Mirrorles ובמצלמות DSLR במצב Live View, ניתן אפילו לעשות זאת בזמן אמת, לפני שמצלמים את התמונה. שימוש נכון בהיסטוגרמה, הן בשטח, בזמן הצילום, והן בשלב עיבוד התמונה, יכולים לעזור בשיפור משמעותי של התוצאה הסופית. 

## מה זו היסטוגרמה?
למי שהספיק לשכוח את החומר מהתיכון נזכיר שהיסטוגרמה, במובן הכללי, היא גרף שמראה קשר בין שני משתנים כלשהם. למשל הקשר בין הטמפרטורה הממוצעת לחודש בשנה, בירושלים:
{{< chart data="chart" >}}

## מה זו היסטוגרמה בצילום?
בתחום הצילום, ההיסטוגרמה היא גרף שמציג את כמות הפיקסלים בתמונה בדרגות הבהירות שונות. ציר ה-X (האופקי) מייצג את רמת הבהירות וציר ה-Y (האנכי) מייצג את כמות הפקסלים בתמונה. לכן, בצד השמאלי של ההיסטוגרמה יוצגו הפיקסלים הכהים ביותר וככל שנלך ימינה על ציר ה-X ייוצגו פיקסלים בהירים יותר ויותר עד לפיקסלים הבהירים ביותר שיוצגו בקצה הימני של ההיסטוגרמה. ככל שיש יותר פיקסלים באותה רמת בהירות כך הקו המשורטט יהיה גבוה יותר. לדוגמא:  

| {{< figure src="milkyway.jpg" width=300 >}} {{< figure src="milkyway-hist-bw.png" width=300 title="תמונה 1" >}}	|	{{< figure src="iceland.jpg" width=300 >}} {{< figure src="iceland-hist-bw.png" width=300 title="תמונה 2" >}}	|
|:-----------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------:|

תמונה 1 צולמה בלילה, רוב הפיקסלים הם כהים, לכן גרף ההיסטוגרמה מציג עליה בגרף בצד ימין, שכזכור מייצג פיקסלים כהים. בתמונת השלג, לעומת זאת, רוב הפיקסלים הם בהירים ולכן הגרף עולה בצד ימין של ההיסטוגרמה.

{{% alert note %}}
חשוב לציין שהיסטוגרמות יכולות להיות קיצוניות, כמו בדוגמאות האלה, ועדיין להיות תקינות לחלוטין כיוון שהן משקפות נאמנה את הסצינה. 
{{% /alert %}}


## מה אפשר ללמוד מההיסטוגרמה?
בעת הצילום יש להיסטוגרמה שני שימושים עיקריים:  
השימוש הראשון הוא מניעת [קטימה](#קטימה---clipping) (Clipping) לא רצויה  של האזורים הבהירים והכהים בסצינה. [הטווח הדינמי](/dictionary#טווח-דינמי---dynamic-range) של כל מצלמה הוא מוגבל לכן סצינות עם קונטרסט גבוה, כמו תמונות נוף באור יום, עלולות לחרוג מהטווח הזה. כאשר מתרחשת קטימה, כל הגוונים הבהירים, שמחוץ לטווח הדינמי, ירשמו כלבנים לגמרי, ובאופן שקול, הגוונים הכהים, שמחוץ לטווח הדינמי, ירשמו כשחורים לגמרי. כיוון שהמידע הזה לא נרשם לקובץ התמונה אין אפשרות להחזיר אותו בשלב העריכה והוא אובד לנצח. קטימה באופן כללי, ובפרט של הגוונים הבהירים, נוטה לפגוע באיכות התמונה ולכן חשוב להמנע ממנה ככל האפשר. מצבים בהם מתרחשת קטימה יוצגו בהיסטוגרמה כקפיצה בקצוות הגרף.
לדוגמה:
|  {{< figure src="horses-dark.jpg" width="800" >}} {{< figure src="horses-dark-hist.png" width="800"  title="תמונה 1" >}} | {{< figure src="horses-light.jpg" width="800" >}} {{< figure src="horses-light-hist.png" width="800" title="תמונה 2" >}} |
|:------------------------------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------------------------------:|

הסצנה שבצילום חורגת ממגבלות הטווח הדינמי של המצלמה. תמונה 1 נחשפה עבור האזורים הבהירים ביותר בשמיים (העננים) אבל אז האזורים הכהים, כמו ראש הסוס, יצאו שחורים לגמרי ואיבדו את המידע שהיה בהם, ניתן לראות זאת לפי הקו הדק הצמוד לקצה השמאלי של ההיסטוגרמה. לעומת זאת, תמונה 2 נחשפה עבור האזורים הכהים של הסצנה. בתמונה זו ניתן לראות את כל הפרטים באזורים הכהים אבל האזורים הבהירים נקטמו ואיבדו מידע, ניתן לראות זאת לפי הפסגה הצמודה לצד הימני של ההיסטוגרמה. חשוב להבין שבכל סצנה שבה הניגודיות חורגת מהטווח הדינמי של החיישן אין דרך להמנע מקטימה ע"י שינוי הגדרות החשיפה. 
ניתן להתגבר על מגבלות הטווח הדינמי בכמה שיטות:
1. לצלם מספר חשיפות עם נתונים שמתאימים לאזורים הבהירים והכהים של התמונה (Bracketing) ולחבר אותן אח"כ בשלב העריכה. כל המצלמות המקצועיות וחצי מקצועיות מאפשרות לבצע Bracketing אוטומטי וזו הגישה המועדפת עלי כיוון שהיא אוספת את כל המידע מהסצנה ומאפשרת לערוך את התמונה אח"כ בכל דרך שנבחר. אפשר לראות את תוצאת החיבור בהמשך המאמר. החסרונות של שיטה זו הם שהיא מתאימה בעיקר לסצינות סטטיות, בהן אין תנועה בין תמונה לתמונה, וכדי לקבל תוצאה מושלמת כדאי לצלם עם חצובה. אבל החיסרון העיקרי שהיא דורשת עבודת עריכה יותר מאומצת.
2. להשתמש בפילטר כהה מדורג Graduated Neutral Density / GND. פילטרים מסוג זה הם כהים בחלקם העליון ושקופים בחלקם התחתון. כיוון שהאזורים הבהירים הם בדרך כלל בשמיים הפילטר מכהה אותם ובכך מקטין את הטווח הדינמי של הסצנה ומאפשר למצלמה לקלוט את כולו. החסרונות של שיטה זו הם רבים, ראשית מדובר בציוד יקר וכבד למדי, סט של פילטרים עם התושבת יכול לשקול כחצי קילו ולעלות כמה אלפי שקלים. שנית, המעבר בין האזור הכהה, בין אם הוא חד או מדורג, הוא תמיד ישר אבל הטבע בדר"כ לא משתף פעולה וכמעט תמיד יש איזה הר או עץ שבולט עמוק לתוך השמיים. שלישילת והכי חשוב, כיוון שהפילטר מקטין את הטווח הדינמי של הסצנה, בפועל מתרחש אובדן מידע ביחס למידע הקיים בסצנה המקורית.
3. בחירה מושכלת איזה קצה של הטווח הדינמי לקטום. בדר"כ עדיף לקטום את הכהים ובסצנות בהן הניגודיות גדולה רק במעט מהטווח של החיישן זה יכול להספיק.

השימוש השני מתאים לסצינות בהן הניגודיות קטנה מהטווח הדינמי ומטרתו לאסוף מידע רב ככל הניתן מהסצנה לצורך עריכה אח"כ. לשם כך ניתן להשתמש בטכניקה שנקראת חשיפה לימין (Expose To The Right) או ETTR בקיצור ועליה נרחיב במאמר נפרד.


## כשההיסטוגרמה משקרת
אני מקווה שמי שהגיע עד כאן השתכנע שההיסטוגרמה היא כלי חשוב ושימושי לכל צלם, ובפרט לצלמי טבע ונוף, הבעיה היחידה היא שהיא משקרת...  
חיישנים מודרניים מקודדים את המידע שהם אוספים, המשקף את הטווח הדינמי, בעזרת 14 ביטים לכל צבע בכל פיקסל. כלומר, עבור כל אחד משלושת צבעי היסוד, החיישן מסוגל להבחין ב-2<sup>45</sup> שהם 16,384 דרגות בהירות. זה המידע שנשמר בקובץ ה-Raw ומשמש לעריכה אח"כ, אלא שהרוב המוחלט של המצלמות, למעט כמה דגמים יקרים להחריד של לייקה, לא מציגים היסטוגרמה המבוססת על קובץ ה-Raw אלא על המרה שלו ל-JPEG. לקבצי JPEG מספר מגבלות המשפיעים על ההיסטוגרמה:
* הם מוגבלים ל-8 ביטים לכל צבע יסוד בכל פיקסל שהם 256 דרגות בהירות.
* בתהליך ההמרה מ-Raw ל-JPEG מופעלת פונקצית מיפוי שנקראת גמה (או S-Curve) שנוטה להגדיל את הניגודיות בתמונה ולמשוך את הקצוות מעבר למה שקובץ ה-JPEG מסוגל לייצג בעזרת 8 הביטים שלו.
* ה-JPEG משקף את ה-Picture style / Creative style (כל יצרן קורא לזה אחרת) שנבחר במצלמה, כמו Portrait או Landscape. הפרופילים האלו עלולים להגדיל את הניגודיות עוד יותר והם ישמשו להצגת ההיסטוגרמה גם אם ההגדרות של המצלמה הן לשמור קובצי Raw בלבד. 
התוצאה של המגבלות האלה הן שלפעמים ה-JPEG יראה מצב של Clipping למרות שבפועל, בקובץ ה-Raw הכל בסדר ולא התרחשה קטימה.
כדי להמנע מכך ככל הניתן חשוב לבחור ב-Picture style עם קונטרסט נמוך ככל האפשר. במצלמות בהן ניתן לשלוט על הפרמטרים של ה-Picture style רצןי להגדיר Custom style עם קונטרסט שלילי. במצלמות בהן זה לא אפשרי ניתן לבחור בפרופיל Neutral. הגדרות אלו יעזרו לצמצם את המקרים בהם נקבל "התראת שווא" מההיסטוגרמה אבל בכל מקרה, לפחות בעיני, עדיפה התראה שווא על המצב ההפוך בו מתרחשת קטימה ללא התראה.

## היסטוגרמה צבעונית
לצורך הפשטות, בכל הדגמאות שלמעלה הצגתי את ההיסטוגרמה המונוכרומטית, שמתייחסת רק לרמות הבהירות הכלליות של התמונה ומתעלמת מהצבעים. בתמונה צבעונית קיימות למעשה שלוש היסטוגרמות שונות, אחת לכל אחד מצבעי היסוד. ברוב המצלמות ותוכנות העריכה הן מוצגות אחת על גבי השניה בדיאגרמה אחת. בהיסטוגרמה כזו כל אחד מצבעי היסוד מיוצג בעזרת ההיסטוגרמה בצבע שלו ואזורי חפיפה מיוצגים ע"י סכום הצבעים. לדוגמה:
|  {{< figure src="horses-comp.jpg" width="800" >}} {{< figure src="horses-comp-hist.png" width="800" >}} | {{< figure src="color-wheel.png" width="800" title="סכומי הצבעים" >}} |
|:-------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------:|




